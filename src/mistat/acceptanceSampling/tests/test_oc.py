'''
Created on Jun 26, 2020

@author: petergedeck
'''
import unittest
from mistat.acceptanceSampling.oc import OperatingCharacteristics2c
import numpy as np


class TestOperatingCharacteristics2c(unittest.TestCase):
    def test_oc2c_1(self):
        oc2 = OperatingCharacteristics2c(10, 1)
        assert oc2.samples == [10]
        assert oc2.acceptance == [1]
        assert oc2.rejection == [2]
        assert oc2.oc_type == 'binomial'

        np.testing.assert_array_equal(oc2.pd, np.linspace(0, 1, 101))
        paccept = [1, 0.995733799757169, 0.983822359313577, 0.965493444491298, 0.941846234321293, 0.913861644100683, 0.88241199543207, 0.848270065271234, 0.812117544852878, 0.774552938234917, 0.7360989291, 0.697209243377895, 0.658275034204041, 0.619630814707374, 0.58155996312436, 0.544299823765527, 0.508046426415468, 0.472958845826877, 0.439163222073435, 0.406756461654868, 0.3758096384, 0.346371112389767, 0.318469384321588, 0.292115701958956, 0.267306434555187, 0.244025230407715, 0.222244971988765, 0.201929542409359, 0.183035416306086, 0.165513087593601, 0.1493083459, 0.134363412896834, 0.120617949150147, 0.108009941553291, 0.0964764808560278, 0.0859544382772461, 0.0763810496802037, 0.0676944152991771, 0.0598339225344849, 0.052740598878682, 0.0463574016, 0.0406294503894916, 0.0355042087755028, 0.0309316197227204, 0.0268642004627987, 0.0232571012491211, 0.0200681323892906, 0.0172577635851252, 0.014789099300942, 0.0126278335864193, 0.0107421875, 0.00910283201231941, 0.00768279901617784,
                   0.00645738282980297, 0.00540403435324067, 0.00450224982333984, 0.0037334559106374, 0.00308089271117285, 0.00252949600754372, 0.0020657800060259, 0.0016777216, 0.00135464706392035, 0.00108712194630954, 0.000866844804433164, 0.000686545307078492, 0.000539887124902343, 0.000421375929799261, 0.000326272735345729, 0.000250512729272484, 0.000190629675778438, 0.0001436859, 0.000107207808761672, 7.9126850531492e-05, 5.77257729613516e-05, 4.15899981809562e-05, 2.95639038085938e-05, 2.07117711153561e-05, 1.42831406054016e-05, 9.68229912669184e-06, 6.44161117777189e-06, 4.1984e-06, 2.6750810145879e-06, 1.66225085328384e-06, 1.00443931392959e-06, 5.88238720860161e-07, 3.32535058593751e-07, 1.8057754889216e-07, 9.36377294635901e-08, 4.602524073984e-08, 2.12451086959099e-08, 9.09999999999997e-09, 3.56039429390999e-09, 1.24554051583999e-09, 3.78113297589998e-10, 9.5335004159999e-11, 1.86523437499998e-11, 2.52706816000003e-12, 1.91515590000002e-13, 5.02784000000006e-15, 9.91000000000001e-18, 0]
        np.testing.assert_array_almost_equal(oc2.paccept, paccept)

    def test_oc2c_2(self):
        oc2 = OperatingCharacteristics2c([125, 125], [1, 4], rejection_numbers=[4, 5], pd=np.linspace(0, 0.1, 101))
        assert oc2.samples == [125, 125]
        assert oc2.acceptance == [1, 4]
        assert oc2.rejection == [4, 5]
        assert oc2.oc_type == 'binomial'

        np.testing.assert_array_equal(oc2.pd, np.linspace(0, 0.1, 101))
        paccept = [1, 0.999987205089941, 0.9997683275467, 0.998771562525497, 0.996117559349714, 0.990807189959407, 0.981906411298203, 0.96868154126125, 0.950674605361029, 0.92772571895803, 0.89995598107544, 0.867725141475902, 0.831576388733525, 0.79217772087748, 0.750266423635912, 0.706600631472699, 0.661919941084548, 0.616915592303829, 0.572209760866675, 0.528342927220442, 0.485767999048198, 0.444849786181813, 0.405868483891072, 0.369025958954567, 0.334453811825023, 0.30222237931004, 0.272350027029704, 0.244812248469158, 0.219550232110389, 0.196478678037157, 0.175492741134377, 0.156474051587771, 0.139295817634293, 0.123827053501502, 0.109936000250811, 0.0974928216231304, 0.0863716634627899, 0.0764521659818153, 0.0676205147645397, 0.0597701103968251, 0.0528019290192858, 0.0466246377676002, 0.0411545205707405, 0.0363152615448874, 0.0320376255195646, 0.0282590682260112, 0.0249233024467946, 0.0219798409914519, 0.0193835327055253, 0.0170941037925871, 0.0150757134673065, 0.013296530290622, 0.0117283333915511,
                   0.0103461410815798, 0.00912786804859703, 0.00805401131548227, 0.00710736440777342, 0.00627275864629092, 0.00553683012181259, 0.00488781068388826, 0.0043153411544553, 0.00381030493408034, 0.00336468018399254, 0.00297140882412819, 0.0026242806730819, 0.00231783115989553, 0.00204725115210033, 0.00180830756338232, 0.00159727352324514, 0.00141086700693409, 0.00124619693447999, 0.00110071585161548, 0.000972178401690254, 0.000858604886192983, 0.000758249292027692, 0.000669571236477984, 0.000591211346168039, 0.000521969644744126, 0.000460786575962052, 0.000406726334911046, 0.000358962220772626, 0.000316763760331894, 0.000279485382931515, 0.000246556455157846, 0.000217472507711092, 0.00019178750803658, 0.00016910705074454, 0.00014908235394702, 0.000131404963683673, 0.000115802080852155, 0.000102032435732262, 8.98826444975565e-05, 7.91639902208524e-05, 6.97095779555499e-05, 6.13718196486258e-05, 5.40202100309366e-05, 4.75393593389354e-05, 4.18272528379413e-05, 3.6793710718047e-05, 3.23590250866104e-05, 2.84527535441431e-05]
        np.testing.assert_array_almost_equal(oc2.paccept, paccept)
